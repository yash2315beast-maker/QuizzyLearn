<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Food Chain Puzzle Game</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #81c784, #4caf50);
      margin: 0;
      padding: 20px;
      color: white;
      text-align: center;
    }

    #backBtn {
      position: fixed;
      top: 15px;
      left: 15px;
      background-color: #feca57;
      color: #222;
      font-weight: 700;
      border: none;
      border-radius: 6px;
      padding: 10px 18px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s;
      z-index: 1000;
    }

    #backBtn:hover {
      background-color: #e6b642;
    }

    h2 {
      margin-bottom: 10px;
    }

    #gameContainer {
      max-width: 900px;
      margin: 0 auto;
      padding-top: 50px;
    }

    #organisms {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    /* Always keep food chain in one line, no scrollbar */
    #chainSlotsContainer {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 5px;
      margin: 20px 0;
      flex-wrap: nowrap;      /* force one line */
      overflow-x: hidden;     /* hide scrollbar */
      padding-bottom: 10px;
    }

    #chainSlots {
      display: flex;
      gap: 5px;
      flex-wrap: nowrap; /* keep slots + arrows in one line */
    }

    .organism,
    .slot {
      background-color: #388e3c;
      border-radius: 10px;
      padding: 15px 20px;
      font-weight: 700;
      font-size: 1.1em;
      user-select: none;
      cursor: grab;
      color: #fff;
      min-width: 100px;
      text-align: center;
      white-space: nowrap;
    }

    .organism.dragging {
      opacity: 0.5;
    }

    .slot {
      background-color: #a5d6a7;
      color: #2e7d32;
      min-height: 50px;
      cursor: pointer;
    }

    .slot.filled {
      background-color: #2e7d32;
      color: white;
    }

    .arrow {
      font-size: 2em;
      color: #c8e6c9;
      user-select: none;
    }

    #buttonsContainer {
      margin-top: 10px;
    }

    button {
      background-color: #2e7d32;
      border: none;
      padding: 12px 30px;
      margin: 10px 10px 0 10px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1.1em;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #1b5e20;
    }

    #message {
      margin-top: 20px;
      font-size: 1.3em;
      font-weight: 700;
      min-height: 2em;
    }

    #finalResult {
      margin-top: 30px;
      font-size: 1.5em;
      font-weight: 700;
      color: #fff59d;
    }

    #badge {
      font-size: 2.5em;
      margin-top: 15px;
    }

    #confetti {
      position: fixed;
      pointer-events: none;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: visible;
      z-index: 9999;
    }

    .confetti-piece {
      position: absolute;
      animation: fall 3s linear forwards;
      opacity: 0.8;
    }

    @keyframes fall {
      to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
  </style>
</head>
<body>

<button id="backBtn" onclick="window.history.back()">Back</button>

<h2>Food Chain Puzzle</h2>
<p>Drag the organisms into the correct order of the food chain.</p>

<div id="gameContainer">
  <div id="organisms"></div>
  <div id="chainSlotsContainer">
    <div id="chainSlots"></div>
  </div>

  <div id="buttonsContainer">
    <button id="checkBtn">Check Answer</button>
    <button id="resetBtn">Reset</button>
    <button id="nextBtn">Next</button>
    <button id="restartBtn" style="display:none;">Play Again</button>
  </div>

  <div id="message"></div>
  <div id="finalResult"></div>
  <div id="badge"></div>
</div>

<div id="confetti"></div>

<script>
  const questions = [
    {
      title: "Food Chain 1",
      chain: ["grass", "grasshopper", "frog", "snake", "hawk"],
    },
    {
      title: "Food Chain 2",
      chain: ["phytoplankton", "zooplankton", "smallfish", "bigfish", "seal"],
    },
    {
      title: "Food Chain 3",
      chain: ["algae", "snail", "fish", "bird", "eagle"],
    },
    {
      title: "Food Chain 4",
      chain: ["leaves", "caterpillar", "bird", "cat", "human"],
    },
    {
      title: "Food Chain 5",
      chain: ["plankton", "shrimp", "crab", "octopus", "shark"],
    }
  ];

  const names = {
    grass: "Grass", grasshopper: "Grasshopper", frog: "Frog", snake: "Snake", hawk: "Hawk",
    phytoplankton: "Phytoplankton", zooplankton: "Zooplankton", smallfish: "Small Fish",
    bigfish: "Big Fish", seal: "Seal", algae: "Algae", snail: "Snail", fish: "Fish",
    bird: "Bird", eagle: "Eagle", leaves: "Leaves", caterpillar: "Caterpillar", cat: "Cat",
    human: "Human", plankton: "Plankton", shrimp: "Shrimp", crab: "Crab", octopus: "Octopus",
    shark: "Shark"
  };

  const organismsContainer = document.getElementById('organisms');
  const chainSlots = document.getElementById('chainSlots');
  const checkBtn = document.getElementById('checkBtn');
  const resetBtn = document.getElementById('resetBtn');
  const nextBtn = document.getElementById('nextBtn');
  const restartBtn = document.getElementById('restartBtn');
  const message = document.getElementById('message');
  const finalResult = document.getElementById('finalResult');
  const badge = document.getElementById('badge');
  const confettiContainer = document.getElementById('confetti');

  let currentQuestionIndex = 0;
  let score = 0;
  let dragged = null;

  function shuffle(array) {
    return array.sort(() => Math.random() - 0.5);
  }

  function initGame() {
    message.textContent = "";
    finalResult.textContent = "";
    badge.textContent = "";
    organismsContainer.innerHTML = "";
    chainSlots.innerHTML = "";
    dragged = null;

    const question = questions[currentQuestionIndex];
    document.querySelector('h2').textContent = question.title;

    const shuffled = shuffle([...question.chain]);
    shuffled.forEach(id => {
      const div = document.createElement('div');
      div.className = 'organism';
      div.setAttribute('draggable', true);
      div.setAttribute('data-id', id);
      div.textContent = names[id];
      div.addEventListener('dragstart', dragStart);
      div.addEventListener('dragend', dragEnd);
      organismsContainer.appendChild(div);
    });

    question.chain.forEach((_, i) => {
      const slot = document.createElement('div');
      slot.className = 'slot';
      slot.addEventListener('dragover', e => e.preventDefault());
      slot.addEventListener('drop', drop);
      slot.addEventListener('click', () => {
        if(slot.firstChild) {
          organismsContainer.appendChild(slot.firstChild);
          slot.classList.remove('filled');
        }
      });
      chainSlots.appendChild(slot);
      if (i < question.chain.length - 1) {
        const arrow = document.createElement('div');
        arrow.className = 'arrow';
        arrow.textContent = 'â†’';
        chainSlots.appendChild(arrow);
      }
    });

    nextBtn.style.display = 'inline-block';
    restartBtn.style.display = 'none';
  }

  function dragStart(e) {
    dragged = e.target;
    setTimeout(() => dragged.classList.add('dragging'), 0);
  }

  function dragEnd() {
    if (dragged) dragged.classList.remove('dragging');
  }

  function drop(e) {
    if (!dragged) return;
    if (e.target.classList.contains('slot')) {
      if (e.target.firstChild) {
        organismsContainer.appendChild(e.target.firstChild);
      }
      e.target.appendChild(dragged);
      e.target.classList.add('filled');
    }
  }

  checkBtn.onclick = () => {
    const slots = document.querySelectorAll('.slot');
    const question = questions[currentQuestionIndex];
    let correct = true;

    slots.forEach((slot, i) => {
      const id = slot.firstChild?.getAttribute('data-id');
      if (id !== question.chain[i]) correct = false;
    });

    if (correct) {
      message.textContent = "âœ… Correct!";
      message.style.color = "#c8e6c9";
      score++;
    } else {
      message.textContent = "âŒ Incorrect. Try again!";
      message.style.color = "#ffcdd2";
    }
  };

  nextBtn.onclick = () => {
    currentQuestionIndex++;
    if (currentQuestionIndex >= questions.length) {
      finishGame();
    } else {
      initGame();
    }
  };

  resetBtn.onclick = initGame;

  restartBtn.onclick = () => {
    currentQuestionIndex = 0;
    score = 0;
    initGame();
  };

  function finishGame() {
    organismsContainer.innerHTML = "";
    chainSlots.innerHTML = "";
    message.textContent = "";
    nextBtn.style.display = "none";
    restartBtn.style.display = "inline-block";

    finalResult.textContent = `ðŸŽ¯ You got ${score} out of ${questions.length} correct!`;

    if (score === questions.length) {
      badge.textContent = "ðŸ† Gold Badge - Perfect!";
      launchConfetti();
    } else if (score >= 3) {
      badge.textContent = "ðŸ¥ˆ Silver Badge - Well Done!";
    } else if (score >= 1) {
      badge.textContent = "ðŸ¥‰ Bronze Badge - Keep Trying!";
    } else {
      badge.textContent = "ðŸ’¡ No Badge - Try Again!";
    }
  }

  function launchConfetti() {
    for (let i = 0; i < 100; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti-piece';
      confetti.textContent = 'ðŸŽ‰';
      confetti.style.left = Math.random() * 100 + 'vw';
      confetti.style.fontSize = Math.random() * 20 + 10 + 'px';
      confetti.style.top = '-10px';
      confetti.style.animationDelay = Math.random() + 's';
      confettiContainer.appendChild(confetti);
      setTimeout(() => confetti.remove(), 3000);
    }
  }

  initGame();
</script>

</body>
</html>
